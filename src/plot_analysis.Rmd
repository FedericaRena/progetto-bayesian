---
title: "R Notebook"
---

```{r,warning=FALSE}
source("include.R")
```

```{r,warning=FALSE}
source("plot functions/plot_functions.R")
```


# Mappa stazioni: REMOVE LEGEND
```{r}
stationPlot <- stationPlot()
```

# Parameters shared
```{r}
initial_date = "2016-01-01"
final_date = "2017-01-01"
every = "month"

# if you change the file_name from None it will create a mp4 video
file_name = "xy plot prova"
```

```{r}
head(data_agc_lomb)
```

# Grid map with chosen variable 
```{r}
initial_date = "2016-01-01"
final_date = "2016-01-01"
every = "month"

# if you change the file_name from None it will create a mp4 video
file_name = "None"

chosen_variable_name = "WE_wind_speed_10m_max"
color_low =  "yellow"
color_high = "blue"

map = gridMap(initial_date,final_date,every,file_name,color_low,color_high,chosen_variable_name)
```


#  Map expanding radius: togliere la legenda

```{r}
initial_date = "2016-01-01"
final_date = "2017-01-01"
every = "month"

# if you change the file_name from None it will create a mp4 video
file_name = "map circles prova"

chosen_var = "AQ_pm10" 


filter_date_list = filter_date(df_agri,initial_date,final_date,every)
data_form_to = filter_date_list[[1]]
len_time = filter_date_list[[2]]

chosen_var = df_date[,chosen_var]



mappa_expanding <- mappa_migliorata+
	geom_point(data =df_date, aes(x=Longitude,y=Latitude),
			   size=lerp_pm10_radius(chosen_var),
			   color = lerp_pm10_color(chosen_var), alpha=0.6)+
	theme(legend.position = "none")+
	theme(panel.grid = element_blank())+
	theme_bw()

if (file_name == "None"){
	mappa_expanding <- mappa_expanding +facet_wrap(~Time)
	print(mappa_expanding)
} else {
	mappa_animata <- mappa_expanding +  
	ggtitle(df_date$Time) +
	transition_time(df_date$Time)+
	labs(title = paste0(every,": {frame_time}"))
	output_file <- paste0("./gifs/",file_name,".mp4")
	anim_save(output_file,mappa_animata,duration = length(date_time),fps = 10, renderer = av_renderer())
}

  
```


# WIND  

```{r}
initial_date = "2016-01-01"
final_date = "2017-01-01"
every = "month"

# if you change the file_name from None it will create a mp4 video
file_name = "wind plot 2016"
wind = windPlot(initial_date,final_date,every,file_name)
```


# xy color+size in time
```{r}
var1_name = "AQ_no2"
var2_name = "WE_wind_speed_100m_mean"
# you can change size to refer to a particular variable
size_name = "LI_bovine"
colors_factor_name = "IDStations"

xyplot <- xyPlot(initial_date,final_date,every,file_name,var1_name,var2_name,size_name,colors_factor_name)

```
# Trend plots
## 1 station - multiple years

```{r}
chosen_station = 1
final_date = "2021-12-31"
file_name = "time_trend"
chosen_variable_name = "AQ_pm10"

trendStationYear_plot = trendStationYear(chosen_station,initial_date,final_date,file_name,chosen_variable_name)
```



## 1 year - multiple stations
```{r}
initial_date = "2016-01-01"
final_date = "2016-12-31"
chosen_stations = 1:4
file_name = "prova trend year"
chosen_variable_name = "AQ_pm10"

trendYearStation_plot <- trendYearStation(initial_date,final_date,chosen_stations,file_name,chosen_variable_name)
```


# TO DO LIST:
- check trend plot animation (Time vs t)
- Map expanding radius bugs
- test all plots
- xyplot remove legend when not needed
- higher video quality mp4 av_renderer?
	for this maybe we just need to use the device parameter, and set it to "svg" as svg does
	not compress images. This is the device help of the animate package:
	The device to use for rendering the single frames.
	Possible values are 'png', 'ragg_png' (requires the ragg package), 'jpeg',
	'tiff', 'bmp', 'svg', and 'svglite' (requires the svglite package). (default 'png')

- crea grafici carini







