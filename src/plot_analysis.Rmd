---
title: "R Notebook"
---

```{r,warning=FALSE}
source("plot functions/plot_functions.R")
source("include.R")
```

# Mappa stazioni
```{r}
stationPlot()
```

# Parameters shared
```{r}
initial_date = "2016-01-01"
final_date = "2016-01-01"
every = "month"

# if you change the file_name from None it will create a mp4 video
file_name = "None"
```


# Grid map with chosen variable 
```{r}
chosen_variable = data_agc_lomb$WE_temp_2m
color_low =  "yellow"
color_high = "blue"

map = gridMap(initial_date,final_date,every,file_name,color_low,color_high)
```


#  Map expanding radius: togliere la legenda

```{r}
chosen_var = "AQ_pm10" 

date_time = as.Date(seq.Date(from=as.Date(initial_date,DATE_FORMAT),
					  to=as.Date(final_date,DATE_FORMAT),by=every))
df_date = df_agri[which(df_agri$Time %in% date_time),]

chosen_var = df_date[,chosen_var]



mappa_expanding <- mappa_migliorata+
	geom_point(data =df_date, aes(x=Longitude,y=Latitude),
			   size=lerp_pm10_radius(df_date$AQ_pm10),
			   color = lerp_pm10_color(df_date$AQ_pm10), alpha=0.6)+
	theme(legend.position = "none")+
	theme(panel.grid = element_blank())+
	theme_bw()

if (file_name == "None"){
	mappa_expanding <- mappa_expanding +facet_wrap(~Time)
	print(mappa_expanding)
} else {
	mappa_animata <- mappa_expanding +  
	ggtitle(df_date$Time) +
	transition_time(df_date$Time)+
	labs(title = paste0(every,": {frame_time}"))
	output_file <- paste0("./gifs/",file_name,".mp4")
	anim_save(output_file,mappa_animata,duration = length(date_time),fps = 10, renderer = av_renderer())
}

  
```


# WIND  

```{r}
wind = windPlot(initial_date,final_date,every,file_name)
```


# xy color+size in time
```{r}
var1_name = "AQ_no2"
var2_name = "AQ_nox"
# you can change size to refer to a particular variable
size_name = 3
colors_factor_name = "IDStations"

xyplot <- xyPlot(initial_date,final_date,every,file_name,var1_name,var2_name,size_name,colors_factor_name)

```
# Trend plots
## 1 station - multiple years

```{r}
chosen_station = 1
final_date = "2021-12-31"
file_name = "time_trend"
chosen_variable_name = "AQ_pm10"

trendStationYear_plot = trendStationYear(chosen_station,initial_date,final_date,file_name,chosen_variable_name)
```



## 1 year - multiple stations
```{r}
initial_date = "2016-01-01"
final_date = "2016-12-31"
chosen_stations = 1:4
file_name = "station_trend"
chosen_variable_name = "AQ_pm10"

trendYearStation_plot <- trendYearStation(initial_date,final_date,chosen_stations,file_name,chosen_variable_name)
```


# TO DO LIST:
- check trend plot animation (Time vs t)
- Map expanding radius bugs
- crea grafici carini







